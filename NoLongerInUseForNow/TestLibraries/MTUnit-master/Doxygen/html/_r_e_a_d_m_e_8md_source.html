<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MTUnit Help: C:/Program Files/MetaTrader 5/MQL5/Experts/MyUnitTestEA/README.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MTUnit Help
   &#160;<span id="projectnumber">v1.0</span>
   </div>
   <div id="projectbrief">MTUnit - A Unit Test framework for MetaTrader 5</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">C:/Program Files/MetaTrader 5/MQL5/Experts/MyUnitTestEA/README.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_r_e_a_d_m_e_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;# README #</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;# MTUnit - A Unit Test framework for MetaTrader 5</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;This project consists in a powerful Unit Test Framework for MetaTrader 5.</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;It was originally based on this article: https:/www.mql5.com/ru/articles/1579</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;As you might know, MetaTrader does not provide any kind of tool for unit testing natively. And that is probably the reason you are here.</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;My goal here was to develop a tool to help me applying Test-Driven-Development in my Expert Advisors. A wise decision since my EAs will be dealing with MY PRECIOUS MONEY!</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;This project is a set of many tools that work together so that the whole process can be automated.</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;Let me summarize some features, then.</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;### First of all: The Unit Test</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;It contains basically all the common assert methods used in unit testing.</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;If you need something more specific, you just need to implement yourself following the examples.</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;The MTUnit executes all the existing test cases of all test suites present in the Test folder. It reports time spent, number of asserts and tests executed, and also messages whether a test passes or fails (really?).</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;The Unit Test itself is amazing but since it is not integrated with MetaEditor, it needs some manual procedures in order to work.</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;For example, for each test written, the following workflow should be used to obtain more complete output results:</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;testCaseInit(), setUp(), testCase(), tearDown(), testCaseDeInit().</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;Also, the TestSuite should be init and deInit once, and the Unit Test library need to be aware of which testing suites it should execute, being necessary to instantiate an object of each testSuite somewhere in the Unit Test.</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;Yes, you can just copy and paste and change the test names, so it&#39;s not a big deal after everything is set up...</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;But this is a lot of manual work and it is enough for many people quit unit testing.</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;There comes the second tool...</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;### 2ยบ Tool: MTUnitTestsCompiler</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;This tool goes through all files in the Test folder and generates an output file (MTUnitAllTests.mqh) containing all declarations and initializations for all tests. This unique file is used by the Unit Test and you don&#39;t even need to touch it. The only thing you need to do is write your tests inside the Test folder.</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;But... Isn&#39;t it frustrating to have to execute this tool every time I write or modify a new test??? If you are questioning yourself about this, welcome to the club of the lazy ones! (Nice to meet you, I&#39;m the president!).</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;Guess what? I&#39;ve made two solutions for you...</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;The first one is the simplest one and probably will be all you need (or not, if you are ok in writing the setups for your tests manually).</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;* There is a Watcher mode that monitors any change inside the Test directory. To enter this mode, just double click the file mtUnitHelper.exe inside the Runners folder.</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;@note Important: If you are cool in using MetaEditor, it&#39;s fine, you are done here. But if you are not so happy with MetaEditor limitations, I suggest you to continue this reading.</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;The second solution is more intense... Let&#39;s talk about environment.</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;``` bash</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;The environment should be protected at any cost! Stop polluting and please recycle your trash!</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;```</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;No no no, not this kind of environment...</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;Here is the thing, I particularly do not like to use the MetaEditor, it seems to be very limited in some important aspects.</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;So, the solution was to set up Sublime Text 3 (http:/www.sublimetext.com) to open .mq5 and .mqh files, apply syntax highlight, build, run the tests and show the output.</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;In order to do that, some scripts are used in Sublime.</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;The first one is: sublime_mql5 (a very suggestive name, indeed)</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;The original version can be found on: https:/github.com/rodrigopandini/sublime_mql5</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;I&#39;ve made some modifications because the feature &quot;Go to definition&quot; was not working as well as a few other minor issues.</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;The version I&#39;m using right know is included inside the &quot;Other&quot; folder.</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;This plugin executes a .bat file during the build phase, this .bat file is responsible for executing the MTUnitTestsCompiler tool,as well as the following (and last) two tools I am going to explain next.</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;In order to run the tests, it is necessary to execute the MetaTerminal. MetaTerminal needs to know the simulation parameters we want to use and to do so, it asks for a config file containing such parameters. One of these parameters is the &quot;Expert&quot;, which is the path to the Expert Advisor we are testing.</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;In order to update this Expert param, this config file should be updated with whatever Expert you are willing to test... And you don&#39;t want to bother in doing something like that, do you?</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;### 3ยบ Tool: MTUnitEALinker</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;So I present you the MTUnitEALinker (good name, right? I&#39;m very creative, I know that).</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;The only thing it does is update that param. Yes, simple as pie, but it was needed.</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;The configuration file used is called autoRunTest.ini.</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;@note You don&#39;t need to interact with this tool. It&#39;s called automatically in the build script on Sublime Text.</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;All done!</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;...</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;No it is not!</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;Did you forget about the output? You wanna see if your tests passed, isn&#39;t it?</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;There we go, last but not least, the final tool: </div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;### Final Tool: MTUnitLogger</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;There is a log file automatic generated by MetaTerminal, but its location is hell, and it varies depending on the account you are using. Mine, for example is </div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;``` bash</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;C:\Program Files\MetaTrader 5\Tester\Agent-127.0.0.1-3000\logs\yyyymmdd.log</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;```</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;And the worst, it updates the freaking name of the file every day.</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;Another little detail, every time you run an Expert Advisor, the log content is appended to this file, so if you basically run 100 times in a single day, your output is going to be huge and unnecessary.</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;So what MTUnitLogger does?</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;It hijacks this log file, and erases the original one! By doing this, we guarantee that the next time you run your EA, the log file will contain information related to the last run only. All you have to do is edit the file logFolderPath.ini and put the correct path where MetaTerminal is generating its logFile. You can do it!</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;Fair enough, but I still have one more thing to tell you.</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;During the hijack, MTUnitLogger also adds some colors to our beautiful green passing tests, and some red to our failing ones. Just like magic!</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;But this is only possible if another plugin is added to Sublime Text, otherwise Sublime can&#39;t interpret output colors. </div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;This wonderful plugin is called SublimeANSI, which you can find here: https:/github.com/aziz/SublimeANSI</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;### Other Thoughts</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;Now, finishing up. The basic file structure you should use should respect that this project is using when you clone it:</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;It follows the MQL file structure, which basically is:</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;* Experts -&gt; Folder to put your EA and where the .ex5 file will be generated.</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;* Include -&gt; Place the MTUnit files and all your EA headers.</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;* Test -&gt; Put all your test files in here so that MTUnitTestsCompiler can generate the proper MTUnitAllTests.mqh file (that will be generated in the Include folder above)</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;* Other -&gt; Contains all the pluggins I&#39;m using right know.</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;* Runners -&gt; The folder where mtUnitHelper.exe (which contains MTUnitTestsCompiler, MTUnitEALinker and MTUnitLogger) and the config files are placed.</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;If you have a special need, you can modify the scripts or rebuild the tools for your own needs.</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;I&#39;ve created a separate git repository for it: https://github.com/rodrigoshaller/MTUnitHelper</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;On MTUnitHelper&#39;s git you can find more detailed information about each tool.</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;The source code of the automation tools is not included in this project because I didn&#39;t want to mix up things. Despite both the MTUnit and the automation tools are used together, you can use them for your own purposes and rewrite them as you need.</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;___</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;### Extra Tool</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;There&#39;s a special Build type that can generates Doxygen documentation automatically as well. You just need to install Doxygen and create a Doxyfile through its GUI interface and place this Doxyfile in your Project&#39;s root folder.</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;There&#39;s also another plugin called DoxyDoc and can be downloaded directly from the Package Manager in Sublime. This plugin makes our life easier while documenting our code, since it injects a comment snippet automatically when you type /** + Return key.</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;___</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;The final result can be seen below:</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;![preview](imgs/preview.gif)</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;Fun Fact: It took me more time to write this text than doing all of this stuff.</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;Anyway, it is up to you now. You can use whatever tool you want, or all of them if it suits you best.</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;Just let me know if you have any suggestions, critiques or doubts.</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;That&#39;s all for today. I hope you enjoy.</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;Cheers,</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;Rodrigo Haller (rodrigoshaller@gmail.com)</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;This project is made under GNU General Public License</div></div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
